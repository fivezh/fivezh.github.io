<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Linux内存之Slab | 小武的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Linux内存管理模式，页式管理适合于大块内存的情形，而对于内核对象级别的较小内存情形下，不足以占用1个页。  在linux内核中会有许多小对象，这些对象构造销毁十分频繁，比如i-node，dentry。这么这些对象如果每次构建的时候就向内存要一个页，而其实际大小可能只有几个字节，这样就非常浪费，为了解决这个问题就引入了一种新的机制来处理在同一页框中如何分配小存储器区。这就是我们要讨论的slab层">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux内存之Slab">
<meta property="og:url" content="http://fivezh.github.io/2017/06/25/Linux-slab-info/index.html">
<meta property="og:site_name" content="小武的博客">
<meta property="og:description" content="Linux内存管理模式，页式管理适合于大块内存的情形，而对于内核对象级别的较小内存情形下，不足以占用1个页。  在linux内核中会有许多小对象，这些对象构造销毁十分频繁，比如i-node，dentry。这么这些对象如果每次构建的时候就向内存要一个页，而其实际大小可能只有几个字节，这样就非常浪费，为了解决这个问题就引入了一种新的机制来处理在同一页框中如何分配小存储器区。这就是我们要讨论的slab层">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-18T06:45:46.769Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux内存之Slab">
<meta name="twitter:description" content="Linux内存管理模式，页式管理适合于大块内存的情形，而对于内核对象级别的较小内存情形下，不足以占用1个页。  在linux内核中会有许多小对象，这些对象构造销毁十分频繁，比如i-node，dentry。这么这些对象如果每次构建的时候就向内存要一个页，而其实际大小可能只有几个字节，这样就非常浪费，为了解决这个问题就引入了一种新的机制来处理在同一页框中如何分配小存储器区。这就是我们要讨论的slab层">
  
    <link rel="alternative" href="/atom.xml" title="小武的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e13dc5f6f08ad2424704273ceda90b8e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
</html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">小武</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录、分享、成长</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/fivezh" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/fivezh" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="http://feed43.com/fivezh_github_io.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Clickhouse/" style="font-size: 10px;">Clickhouse</a> <a href="/tags/Composer/" style="font-size: 10px;">Composer</a> <a href="/tags/Database/" style="font-size: 10px;">Database</a> <a href="/tags/Flask/" style="font-size: 10px;">Flask</a> <a href="/tags/Golang/" style="font-size: 16.67px;">Golang</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Http/" style="font-size: 10px;">Http</a> <a href="/tags/Java/" style="font-size: 11.67px;">Java</a> <a href="/tags/Laravel/" style="font-size: 10px;">Laravel</a> <a href="/tags/LeetCode/" style="font-size: 20px;">LeetCode</a> <a href="/tags/Life/" style="font-size: 13.33px;">Life</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Lumen/" style="font-size: 11.67px;">Lumen</a> <a href="/tags/Memcached/" style="font-size: 10px;">Memcached</a> <a href="/tags/Movie/" style="font-size: 10px;">Movie</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Nagios/" style="font-size: 11.67px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 11.67px;">Nginx</a> <a href="/tags/OpenCode/" style="font-size: 10px;">OpenCode</a> <a href="/tags/PHP/" style="font-size: 18.33px;">PHP</a> <a href="/tags/PHP7/" style="font-size: 11.67px;">PHP7</a> <a href="/tags/Python/" style="font-size: 16.67px;">Python</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Scapy/" style="font-size: 10px;">Scapy</a> <a href="/tags/Scapy-http/" style="font-size: 10px;">Scapy_http</a> <a href="/tags/Sublime/" style="font-size: 10px;">Sublime</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">KISS: Keep It Simple &amp; Stupid.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">小武</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/avatar.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">小武</h1>
			</hgroup>
			
			<p class="header-subtitle">记录、分享、成长</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/fivezh" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/fivezh" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="http://feed43.com/fivezh_github_io.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-Linux-slab-info" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/25/Linux-slab-info/" class="article-date">
  	<time datetime="2017-06-25T09:25:49.000Z" itemprop="datePublished">2017-06-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Linux内存之Slab
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
<!-- Table of Contents -->

        <p>Linux内存管理模式，页式管理适合于大块内存的情形，而对于内核对象级别的较小内存情形下，不足以占用1个页。</p>
<blockquote>
<p>在linux内核中会有许多小对象，这些对象构造销毁十分频繁，比如i-node，dentry。这么这些对象如果每次构建的时候就向内存要一个页，而其实际大小可能只有几个字节，这样就非常浪费，为了解决这个问题就引入了一种新的机制来处理在同一页框中如何分配小存储器区。这就是我们要讨论的slab层。在讲述slab前，我想先铺垫一下有关内存页的概念，我们都知道在linux中内存都是以页为单位来进行管理的(通常为4KB)，当内核需要内存就调用如：kmem_getpages这样的接口(底层调用__alloc_pages())。那么内核是如何管理页的分配的，这里linux使用了伙伴算法。slab也是向内核申请一个个页，然后再对这些页框做管理来达到分配小存储区的目的的。</p>
</blockquote>
<a id="more"></a>
<h3 id="什么是Slab呢？"><a href="#什么是Slab呢？" class="headerlink" title="什么是Slab呢？"></a>什么是Slab呢？</h3><p>最早于1994年在Sun系统中被提出(The Slab Allocator: An Object-Caching Kernel Memory Allocator, Jeff Bonwick (Sun Microsystems))，Slab是一种内存分配器，通过将内存划分不同大小的空间分配给对象使用来进行缓存管理，应用于内核对象的缓存。</p>
<blockquote>
<p>A slab is a set of one or more contiguous pages of memory set aside by the slab allocator for an individual cache. This memory is further divided into equal segments the size of the object type that the cache is managing.</p>
</blockquote>
<h3 id="Slab的两个主要作用："><a href="#Slab的两个主要作用：" class="headerlink" title="Slab的两个主要作用："></a>Slab的两个主要作用：</h3><ul>
<li>Slab对小对象进行分配，不用为每个小对象分配一个页，节省了空间。</li>
<li>内核中一些小对象创建析构很频繁，Slab对这些小对象做缓存，可以重复利用一些相同的对象，减少内存分配次数。<h2 id="proc-meminfo的Slab和SReclaimable项"><a href="#proc-meminfo的Slab和SReclaimable项" class="headerlink" title="/proc/meminfo的Slab和SReclaimable项"></a>/proc/meminfo的Slab和SReclaimable项</h2>其中<code>Slab=SReclaimable+SUnreclaim</code>，<code>SReclaimable</code>表示可回收使用的内存。<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> cat /proc/meminfo</span></span><br><span class="line">MemTotal:       15993324 kB</span><br><span class="line">MemFree:          178448 kB</span><br><span class="line">MemAvailable:   14670236 kB</span><br><span class="line">Buffers:          166740 kB</span><br><span class="line">Cached:          3704632 kB</span><br><span class="line">SwapCached:            0 kB</span><br><span class="line">Active:          3337344 kB</span><br><span class="line">Inactive:        1151668 kB</span><br><span class="line">Active(anon):     717392 kB</span><br><span class="line">Inactive(anon):   116980 kB</span><br><span class="line">Active(file):    2619952 kB</span><br><span class="line">Inactive(file):  1034688 kB</span><br><span class="line">Unevictable:           0 kB</span><br><span class="line">Mlocked:               0 kB</span><br><span class="line">SwapTotal:             0 kB</span><br><span class="line">SwapFree:              0 kB</span><br><span class="line">Dirty:               236 kB</span><br><span class="line">Writeback:             0 kB</span><br><span class="line">AnonPages:        617560 kB</span><br><span class="line">Mapped:            84988 kB</span><br><span class="line">Shmem:            216732 kB</span><br><span class="line">Slab:           11165136 kB // Slab总量</span><br><span class="line">SReclaimable:   11090552 kB // 可回收Slab量</span><br><span class="line">SUnreclaim:        74584 kB</span><br><span class="line">.............. // 其他信息省略</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="命令slabtop查看slab占用情况"><a href="#命令slabtop查看slab占用情况" class="headerlink" title="命令slabtop查看slab占用情况"></a>命令slabtop查看slab占用情况</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> slabtop</span></span><br><span class="line"> Active / Total Objects (% used)    : 131433 / 135261 (97.2%)</span><br><span class="line"> Active / Total Slabs (% used)      : 5390 / 5390 (100.0%)</span><br><span class="line"> Active / Total Caches (% used)     : 63 / 87 (72.4%)</span><br><span class="line"> Active / Total Size (% used)       : 28769.26K / 30102.88K (95.6%)</span><br><span class="line"> Minimum / Average / Maximum Object : 0.01K / 0.22K / 8.00K</span><br><span class="line"></span><br><span class="line">  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME                   </span><br><span class="line"> 23616  23616 100%    0.21K   1312   18  5248K vm_area_struct</span><br><span class="line"> 22080  21832  98%    0.06K    345   64  1380K kmalloc-64</span><br><span class="line"> 12831  12080  94%    0.19K    611   21  2444K dentry</span><br><span class="line"> 10044  10044 100%    0.11K    279   36  1116K sysfs_dir_cache</span><br><span class="line">  8109   7568  93%    0.08K    159   51   636K selinux_inode_security</span><br><span class="line">  7936   7936 100%    0.06K    124   64   496K anon_vma</span><br><span class="line">  7722   7722 100%    0.10K    198   39   792K buffer_head</span><br><span class="line">  6110   5759  94%    0.58K    470   13  3760K inode_cache</span><br><span class="line">  4732   4694  99%    0.57K    338   14  2704K radix_tree_node</span><br><span class="line">  3072   3072 100%    0.01K  6  512        24K kmalloc-8</span><br><span class="line">  3072   3056  99%    0.96K    384        8  3072K ext4_inode_cache</span><br><span class="line">  2848   2574  90%    0.25K    178   16   712K kmalloc-256</span><br><span class="line">  2380   2380 100%    0.05K     28   85   112K shared_policy_node</span><br><span class="line">  2048   2048 100%    0.02K  8  256        32K kmalloc-16</span><br><span class="line">  2040   1530  75%    0.04K     20  102        80K jbd2_journal_handle</span><br><span class="line">  2016   1615  80%    0.19K     96   21   384K kmalloc-192</span><br><span class="line">  1776   1776 100%    0.64K    148   12  1184K proc_inode_cache</span><br><span class="line">  1288   1288 100%    0.07K     23   56        92K Acpi-ParseExt</span><br><span class="line">  1152   1152 100%    0.03K  9  128        36K kmalloc-32</span><br><span class="line">  1152    832  72%    0.06K     18   64        72K ext4_io_end</span><br><span class="line">  1140   1140 100%    0.66K     95   12   760K shmem_inode_cache</span><br><span class="line">  1072   1053  98%    1.00K    134        8  1072K kmalloc-1024</span><br><span class="line">   960    960 100%    0.12K     30   32   120K kmalloc-128</span><br><span class="line">   672    672 100%    0.09K     16   42        64K kmalloc-96</span><br><span class="line">   432    394  91%    0.50K     54        8   216K kmalloc-512</span><br><span class="line">   408    408 100%    0.04K  4  102        16K Acpi-Namespace</span><br><span class="line">   408    324  79%    0.62K     34   12   272K sock_inode_cache</span><br><span class="line">   352    243  69%    2.00K     44        8   704K kmalloc-2048</span><br><span class="line">   340    340 100%    0.12K     10   34        40K fsnotify_event</span><br><span class="line">   256    256 100%    0.03K  2  128         8K jbd2_revoke_record_s</span><br><span class="line">   256    256 100%    0.02K  1  256         4K jbd2_revoke_table_s</span><br><span class="line">   224    224 100%    0.25K     14   16        56K tw_sock_TCP</span><br><span class="line">   208    208 100%    0.94K     26        8   208K RAW</span><br><span class="line">   190    190 100%    0.81K     10   19   160K task_xstate</span><br><span class="line">   187    154  82%    2.84K     17   11   544K task_struct</span><br><span class="line">   180    180 100%    0.38K     18   10        72K blkdev_requests</span><br><span class="line">   180    180 100%    0.11K  5   36        20K jbd2_journal_head</span><br><span class="line">   180    180 100%    0.13K  6   30        24K ext4_allocation_context</span><br><span class="line">   154    139  90%    1.12K     11   14   176K signal_cache</span><br><span class="line">   150    150 100%    2.06K     10   15   320K idr_layer_cache</span><br><span class="line">   150    143  95%    2.06K     10   15   320K sighand_cache</span><br><span class="line">   128    128 100%    0.06K  2   64         8K kmem_cache_node</span><br><span class="line">   117    117 100%    0.10K  3   39        12K blkdev_ioc</span><br><span class="line">   112    102  91%    4.00K     14        8   448K kmalloc-4096</span><br><span class="line">   110    101  91%    1.56K     11   10   176K mm_struct</span><br><span class="line">   108    108 100%    0.62K  9   12        72K files_cache</span><br><span class="line">    96     96 100%    0.25K  6   16        24K kmem_cache</span><br><span class="line">    96     62  64%    1.88K     12        8   192K TCP</span><br><span class="line">    73     73 100%    0.05K  1   73         4K ip_fib_trie</span><br><span class="line">    64     64 100%    0.25K  4   16        16K dquot</span><br><span class="line">    46     46 100%    0.09K  1   46         4K ext4_xattr</span><br><span class="line">    40     20  50%    8.00K     10        4   320K kmalloc-8192</span><br><span class="line">    25     25 100%    0.16K  1   25         4K sigqueue</span><br><span class="line">    19     19 100%    0.81K  1   19        16K bdev_cache</span><br><span class="line">    16     16 100%    1.88K  2        8        32K blkdev_queue</span><br><span class="line">    15     15 100%    0.26K  1   15         4K numa_policy</span><br></pre></td></tr></table></figure>
<h2 id="系统缓存回收机制的设置项"><a href="#系统缓存回收机制的设置项" class="headerlink" title="系统缓存回收机制的设置项"></a>系统缓存回收机制的设置项</h2><p>系统默认内存回收配置在<code>/proc/sys/vm/drop_caches</code>中，除非明确知晓改动对系统全局影响，不建议对此进行修改。</p>
<blockquote>
<p>0：不做任何处理，由系统自己管理 1：清空pagecache 2：清空dentries和inodes 3：清空pagecache、dentries和inodes</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cat /proc/sys/vm/drop_caches</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<h2 id="proc-slabinfo文件信息"><a href="#proc-slabinfo文件信息" class="headerlink" title="/proc/slabinfo文件信息"></a>/proc/slabinfo文件信息</h2><p>在Slab中，可分配内存块称为<strong>对象</strong>，下图中<code>kmalloc-8</code>表示每个对象占用8Bit大小的普通Slab，同理<code>kmalloc-16</code>中每个对象占用16B，依次类推，找出Slab中占用量较大的对象是哪些？</p>
<blockquote>
<p>每种对象占用总内存量 = num_objs*objsize</p>
</blockquote>
<p>列出几种对象的内存空间占有量：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>对象数量</th>
<th>每个对象大小(B)</th>
<th>该类型所有对象总量(B)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ext4_inode_cache</td>
<td>6168</td>
<td>984</td>
<td>6069312</td>
</tr>
<tr>
<td>ext4_inode_cache</td>
<td>6168</td>
<td>984</td>
<td>6069312</td>
</tr>
</tbody>
</table>
<ul>
<li>统计Slab占用超过100M的对象：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat /proc/slabinfo |awk &apos;&#123;if($3*$4/1024/1024 &gt; 100)&#123;print $1,$3*$4/1024/1024&#125; &#125;&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">sudo cat /proc/slabinfo  </span><br><span class="line">slabinfo - version: 2.1</span><br><span class="line"># name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt;</span><br><span class="line">ext4_inode_cache    1560   6168    984    8    2 : tunables    0    0    0 : slabdata    771    771      0</span><br><span class="line">ext4_xattr            46     46     88   46    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">ext4_allocation_context    180    180    136   30    1 : tunables    0    0    0 : slabdata      6      6      0</span><br><span class="line">ext4_io_end         1920   2240     64   64    1 : tunables    0    0    0 : slabdata     35     35      0</span><br><span class="line">jbd2_journal_handle   2448   2448     40  102    1 : tunables    0    0    0 : slabdata     24     24      0</span><br><span class="line">jbd2_journal_head    468    468    112   36    1 : tunables    0    0    0 : slabdata     13     13      0</span><br><span class="line">jbd2_revoke_table_s    256    256     16  256    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">jbd2_revoke_record_s    384    384     32  128    1 : tunables    0    0    0 : slabdata      3      3      0</span><br><span class="line">scsi_cmd_cache         9      9    448    9    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">UDPLITEv6              0      0   1152   14    4 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">UDPv6                 14     14   1152   14    4 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">tw_sock_TCPv6          0      0    256   16    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">TCPv6                  8      8   2048    8    4 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">cfq_queue              0      0    232   17    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">bsg_cmd                0      0    312   13    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">mqueue_inode_cache      9      9    896    9    2 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">hugetlbfs_inode_cache     13     13    608   13    2 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">configfs_dir_cache     46     46     88   46    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">dquot                 64     64    256   16    1 : tunables    0    0    0 : slabdata      4      4      0</span><br><span class="line">pid_namespace          0      0   2176   15    8 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">posix_timers_cache      0      0    248   16    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">UDP-Lite               0      0   1024    8    2 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">ip_fib_trie           73     73     56   73    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">RAW                  208    208    960    8    2 : tunables    0    0    0 : slabdata     26     26      0</span><br><span class="line">UDP                    8      8   1024    8    2 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">tw_sock_TCP          224    224    256   16    1 : tunables    0    0    0 : slabdata     14     14      0</span><br><span class="line">TCP                   61     96   1920    8    4 : tunables    0    0    0 : slabdata     12     12      0</span><br><span class="line">blkdev_queue          16     16   1920    8    4 : tunables    0    0    0 : slabdata      2      2      0</span><br><span class="line">blkdev_requests      160    160    384   10    1 : tunables    0    0    0 : slabdata     16     16      0</span><br><span class="line">blkdev_ioc           117    117    104   39    1 : tunables    0    0    0 : slabdata      3      3      0</span><br><span class="line">fsnotify_event_holder      0      0     24  170    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">fsnotify_event       914    952    120   34    1 : tunables    0    0    0 : slabdata     28     28      0</span><br><span class="line">sock_inode_cache     321    408    640   12    2 : tunables    0    0    0 : slabdata     34     34      0</span><br><span class="line">net_namespace          0      0   4224    7    8 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">shmem_inode_cache   1090   1128    680   12    2 : tunables    0    0    0 : slabdata     94     94      0</span><br><span class="line">Acpi-ParseExt       1288   1288     72   56    1 : tunables    0    0    0 : slabdata     23     23      0</span><br><span class="line">Acpi-Namespace       408    408     40  102    1 : tunables    0    0    0 : slabdata      4      4      0</span><br><span class="line">taskstats             24     24    328   12    1 : tunables    0    0    0 : slabdata      2      2      0</span><br><span class="line">proc_inode_cache    1584   1584    656   12    2 : tunables    0    0    0 : slabdata    132    132      0</span><br><span class="line">sigqueue              25     25    160   25    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">bdev_cache            19     19    832   19    4 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">sysfs_dir_cache    10044  10044    112   36    1 : tunables    0    0    0 : slabdata    279    279      0</span><br><span class="line">inode_cache         5778   6175    592   13    2 : tunables    0    0    0 : slabdata    475    475      0</span><br><span class="line">dentry              9326  13986    192   21    1 : tunables    0    0    0 : slabdata    666    666      0</span><br><span class="line">iint_cache             0      0     80   51    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">selinux_inode_security   7568   8109     80   51    1 : tunables    0    0    0 : slabdata    159    159      0</span><br><span class="line">buffer_head         2293  10998    104   39    1 : tunables    0    0    0 : slabdata    282    282      0</span><br><span class="line">vm_area_struct     21510  21510    216   18    1 : tunables    0    0    0 : slabdata   1195   1195      0</span><br><span class="line">mm_struct             85    120   1600   10    4 : tunables    0    0    0 : slabdata     12     12      0</span><br><span class="line">files_cache          108    108    640   12    2 : tunables    0    0    0 : slabdata      9      9      0</span><br><span class="line">signal_cache         135    168   1152   14    4 : tunables    0    0    0 : slabdata     12     12      0</span><br><span class="line">sighand_cache        131    150   2112   15    8 : tunables    0    0    0 : slabdata     10     10      0</span><br><span class="line">task_xstate          190    190    832   19    4 : tunables    0    0    0 : slabdata     10     10      0</span><br><span class="line">task_struct          153    187   2912   11    8 : tunables    0    0    0 : slabdata     17     17      0</span><br><span class="line">anon_vma            7108   7168     64   64    1 : tunables    0    0    0 : slabdata    112    112      0</span><br><span class="line">shared_policy_node   3914   4335     48   85    1 : tunables    0    0    0 : slabdata     51     51      0</span><br><span class="line">numa_policy           15     15    264   15    1 : tunables    0    0    0 : slabdata      1      1      0</span><br><span class="line">radix_tree_node     5399   8288    584   14    2 : tunables    0    0    0 : slabdata    592    592      0</span><br><span class="line">idr_layer_cache      150    150   2112   15    8 : tunables    0    0    0 : slabdata     10     10      0</span><br><span class="line">dma-kmalloc-8192       0      0   8192    4    8 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-4096       0      0   4096    8    8 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-2048       0      0   2048    8    4 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-1024       0      0   1024    8    2 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-512        0      0    512    8    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-256        0      0    256   16    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-128        0      0    128   32    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-64         0      0     64   64    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-32         0      0     32  128    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-16         0      0     16  256    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-8          0      0      8  512    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-192        0      0    192   21    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">dma-kmalloc-96         0      0     96   42    1 : tunables    0    0    0 : slabdata      0      0      0</span><br><span class="line">kmalloc-8192          20     40   8192    4    8 : tunables    0    0    0 : slabdata     10     10      0</span><br><span class="line">kmalloc-4096          92    112   4096    8    8 : tunables    0    0    0 : slabdata     14     14      0</span><br><span class="line">kmalloc-2048         216    240   2048    8    4 : tunables    0    0    0 : slabdata     30     30      0</span><br><span class="line">kmalloc-1024         976    992   1024    8    2 : tunables    0    0    0 : slabdata    124    124      0</span><br><span class="line">kmalloc-512          334    376    512    8    1 : tunables    0    0    0 : slabdata     47     47      0</span><br><span class="line">kmalloc-256         2185   2592    256   16    1 : tunables    0    0    0 : slabdata    162    162      0</span><br><span class="line">kmalloc-192         1324   1764    192   21    1 : tunables    0    0    0 : slabdata     84     84      0</span><br><span class="line">kmalloc-128          992    992    128   32    1 : tunables    0    0    0 : slabdata     31     31      0</span><br><span class="line">kmalloc-96           756    756     96   42    1 : tunables    0    0    0 : slabdata     18     18      0</span><br><span class="line">kmalloc-64         19961  21248     64   64    1 : tunables    0    0    0 : slabdata    332    332      0</span><br><span class="line">kmalloc-32          1792   1792     32  128    1 : tunables    0    0    0 : slabdata     14     14      0</span><br><span class="line">kmalloc-16          2048   2048     16  256    1 : tunables    0    0    0 : slabdata      8      8      0</span><br><span class="line">kmalloc-8           3072   3072      8  512    1 : tunables    0    0    0 : slabdata      6      6      0</span><br><span class="line">kmem_cache_node      128    128     64   64    1 : tunables    0    0    0 : slabdata      2      2      0</span><br><span class="line">kmem_cache            96     96    256   16    1 : tunables    0    0    0 : slabdata      6      6      0</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>上述简要概述了内核Slab内存分配器的作用、意义，如何在Linux中查询、分析当前系统的Slab内存占用情况，从而合理评估系统内存的可用资源。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://gityuan.com/2015/10/30/kernel-memory/" target="_blank" rel="noopener">Linux内存管理</a></li>
<li><a href="https://blog.famzah.net/2014/09/22/know-your-linux-memory-usage/" target="_blank" rel="noopener">Know your Linux memory usage</a></li>
<li><a href="https://linux-mm.org/Low_On_Memory" target="_blank" rel="noopener">Low On Memory</a></li>
<li><a href="http://www.cnblogs.com/tolimit/p/4566189.html" target="_blank" rel="noopener">linux内存源码分析 - SLAB分配器概述</a></li>
<li><a href="http://www.secretmango.com/jimb/Whitepapers/slabs/slab.html" target="_blank" rel="noopener">Overview of Linux Memory Management Concepts: Slabs</a></li>
<li><a href="http://blog.yufeng.info/archives/2456" target="_blank" rel="noopener">Linux Used内存到底哪里去了？</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/23/MySQL-InnoDB-online-DDL/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          MySQL InnoDB在线调整表结构(online DDL)-新增字段篇
        
      </div>
    </a>
  
  
    <a href="/2017/06/18/centos-7-memory-available/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">探究CentOS 7可用内存</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>








<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'fivezh'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2022 小武
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<!-- <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script> -->
<script src="https://cdn.bootcdn.net/ajax/libs/require.js/2.1.6/require.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>